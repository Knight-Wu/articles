
# 分区的目的

提供扩展性

# 分区种类

## hash 分区

一致性hash; 

* hash 不能做范围查询, 但是可以用多个字段作为分区查询的key, 第一个字段用作hash 分区, 后续字段用作范围分区, 等于总的分区数是几个分区数的乘积. 组合的方式. 

Cassandra 可以将多个列作为复合主键, 第一个列用作 hash 分区的 key, 后几列用作 range 分区的 key, 当第一列指定的时候, 可以对后几列做范围查询, 例如 key: {userId, update_timestamp} 就很适用
## range 范围分区
某个范围的很有可能有热点, 例如最近的时间或者某个userId
## 如何解决分区的某个key 的热点
加随机数, 但是要记录, 或者遍历所有随机的可能

## 二级索引
就是根据某些关键字段, 非主键的字段构建从该字段到主键的索引, 例如搜索汽车颜色, 根据颜色返回汽车主键, 再通过主键查找汽车.

## 分区再分配
例如某个broker 挂了, 上面的所有replica 都要分配给其他broker. 

* hash 取模

会导致全部分区的数据都要搬迁.

* 固定数量的分区

难以估算正确的数量, 难以应对数据变动大, 

* 动态分区

例如hbase, 分区的数量会随数据变动. 可以进行分区合并和分裂

* 每个节点有固定数量的分区

## 分区如何分散, 让节点间负载均衡


## 如何路由
请求如何转发到正确的分区, 一是轮训, 二是持有映射关系, 用路由层或者客户端.
