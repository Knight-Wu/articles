 分布式系统的设计
可以参考es 如何基于lucene 构建分布式搜索引擎的
单机存储随着业务的增长会遇到性能与单点故障问题。通常有两种解决方案：

* 数据分布

就是把数据分块存在不同的服务器上（分库分表）, 解决单机性能问题. 常见的有hash 分布, 范围分布

* 数据复制

让所有的服务器都有相同的数据，提供相当的服务, 解决单机故障问题. 有主从复制, 和对等复制.

* cap 理论

在理論計算機科學中，CAP定理（CAP theorem），又被稱作布魯爾定理（Brewer's theorem），它指出對於一個分布式计算系統來說，不可能同時滿足以下三點：[1][2]

一致性（Consistency） （等同于所有节点访问同一份最新的数据副本）
可用性（Availability）（每次请求都能获取到非错的响应——但是不保证获取的数据为最新数据）
分区容错性（Partition tolerance）（以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择[3]。）
根據定理，分佈式系統只能滿足三項中的兩項而不可能滿足全部三項[4]。理解CAP理论的最简单方式是想象两个节点分处分区两侧。允许至少一个节点更新状态会导致数据不一致，即丧失了C性质。如果为了保证数据一致性，将分区一侧的节点设置为不可用，那么又丧失了A性质。除非两个节点可以互相通信，才能既保证C又保证A，这又会导致丧失P性质。

* 两阶段提交

如果第二阶段提交时, 有节点回复失败, 要回滚, 然后此时有部分节点又回滚失败了呢? 多个节点数据不一致, 只要大多数节点是一致的就是可用的? 
