### CAP定理
三个原则只能最多满足两个
* Consistency 一致性
意思是，写操作之后的读操作，必须返回该值。
* Partition tolerance 分区容错性
大多数分布式系统都分布在多个子网络。每个子网络就叫做一个区（partition）。分区容错的意思是，区间通信可能失败。比如，一台服务器放在中国，另一台服务器放在美国，这就是两个区，它们之间可能无法通信。**可以认为P 是一定要满足的, 所以 C 和A 只能满足一个**

* Availability 
中文叫做"可用性"，意思是只要收到用户的请求，服务器就必须给出回应。

*  Consistency 和 Availability 的矛盾
多台服务器在数据同步的过程中, server 1 在向server 2 同步数据的时候, 必须锁住server 2, 否则可能读出不一致的数据, 当同步完成之后才能开放server 2的服务. 

* 在什么场合，可用性高于一致性？
举例来说，发布一张网页到 CDN，多个服务器有这张网页的副本。后来发现一个错误，需要更新网页，这时只能每个服务器都更新一遍。
一般来说，网页的更新不是特别强调一致性。短时期内，一些用户拿到老版本，另一些用户拿到新版本，问题不会特别大。当然，所有人最终都会看到新版本。所以，这个场合就是可用性高于一致性。

### BASE 定理
Basically Available(基本可用)、Soft state(软状态)和 Eventually consistent (最终一致性)三个短语的缩写。是对CAP中AP的一个扩展

1.  基本可用:分布式系统在出现故障时，允许损失部分可用功能，保证核心功能可用。
2.  软状态:允许系统中存在中间状态，这个状态不影响系统可用性，这里指的是CAP中的不一致。
3.  最终一致:最终一致是指经过一段时间后，所有节点数据都将会达到一致。

在BASE中用软状态和最终一致，保证了延迟后的一致性。BASE和 ACID 是相反的，它完全不同于ACID的强一致性模型，而是通过牺牲强一致性来获得可用性，并允许数据在一段时间内是不一致的，但最终达到一致状态。

### 两阶段提交协议 2PC
1. 第一阶段(投票阶段):
a. 协调者询问工作者是否可以执行提交操作, 并等待响应
b. 工作者执行事务操作, 并记录所有的undo和redo 日志
c. 工作者返回协调者事务是否成功的消息
2. 第二阶段(提交):
当工作者返回的消息均为事务成功的话, 协调者向各个工作者发出提交""

> Written with [StackEdit](https://stackedit.io/).
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE2MzA3ODg2MzAsMTU4OTMxMTE1Miw1ND
E1ODA3ODYsLTIwNTQyOTY5NzddfQ==
-->